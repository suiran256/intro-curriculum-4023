extends layout

block content
  div.card.my-3
    div.card-header
      h4 #{schedule.scheduleName}
    div.card-body
      p(style="white-space:pre;") #{schedule.memo}
    div.card-footer
      p createdBy #{schedule.User.username}
  - var isMine = parseInt(user.id) === schedule.User.userId
  if isMine
    div
      a(href=`/schedules/${schedule.scheduleId}/edit`).btn.btn-info editSchedule
  h3.my-3 availabilities
  table.table.table-bordered
    - var users = Array.from(userOtherMap.values())
    - var availabilityLabels = ['ketsu', '?', 'de'];
    - var buttonStyles = ['btn-danger', 'btn-secondary', 'btn-success'];
    tr
      th candidate
      th #{userMe.username}
      each user in users
        th #{user.username}
    each candidate in candidates
      - var getAvailability = function(u){return ((availabilityMapMap.get(u.userId)||new Map()).get(candidate.candidateId) ||0)}
      tr
        th #{candidate.candidateName}
        td
          - var availability = getAvailability(userMe)
          button(class=`availability-toggle-button btn-lg ${buttonStyles[availability]}`
            data-schedule-id=schedule.scheduleId
            data-user-id=userMe.userId
            data-candidate-id=candidate.candidateId
            data-availability=availability) #{availabilityLabels[availability]}
        each user in users
          - var availability = getAvailability(user)
          td
            h3 #{availabilityLabels[availability]}
    tr
      th comment
      td
        p
          small#self-comment #{commentMap.get(userMe.userId)}
        button(
          data-schedule-id=schedule.scheduleId
          data-user-id=userMe.userId)#self-comment-button.btn-sm.btn-info edit
      each user in users
        td
          p
            small #{commentMap.get(user.userId)}
